@prefix xsd:<http://www.w3.org/2001/XMLSchema#>.
@prefix rdf:<http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs:<http://www.w3.org/2000/01/rdf-schema#>.
@prefix owl:<http://www.w3.org/2002/07/owl#>.
@prefix obj:<http://www.openrdf.org/rdf/2009/object#>.
@prefix http:<http://www.openrdf.org/rdf/2009/httpobject#>.
@prefix calli:<http://callimachusproject.org/rdf/2009/framework#>.
@prefix purl:<http://persistent.name/rdf/2010/purl#>.

purl:search rdfs:subClassOf obj:Message;
	rdfs:subClassOf [owl:onProperty obj:target;
		owl:allValuesFrom purl:Server];
	rdfs:subClassOf [owl:onProperty obj:functionalObjectResponse;
		owl:allValuesFrom obj:TupleResult].

purl:search-arg a owl:DatatypeProperty, owl:FunctionalProperty;
	rdfs:domain purl:search;
	rdfs:range xsd:string;
	http:parameter "q";
	obj:name "q".

<#template.xsl> rdfs:subClassOf obj:Message;
	rdfs:subClassOf [owl:onProperty obj:functionalObjectResponse; owl:allValuesFrom <java:java.io.InputStream>];
	http:type "text/html";
	obj:xslt <template.xsl>.

<#template.xsl-input> a owl:ObjectProperty; a owl:FunctionalProperty;
	rdfs:domain <#template.xsl>;
	rdfs:range <java:java.io.InputStream>.

<#search.xsl> rdfs:subClassOf obj:Message;
	rdfs:subClassOf [owl:onProperty obj:functionalObjectResponse;
		owl:allValuesFrom <java:java.io.InputStream>];
	http:type "application/xml";
	http:transform <#template.xsl>;
	obj:xslt <search.xsl>.

<#search.xsl-input> a owl:ObjectProperty; a owl:FunctionalProperty;
	rdfs:domain <#search.xsl>;
	rdfs:range <java:java.io.InputStream>.

<#user-search.xsl> rdfs:subClassOf <#search.xsl>;
	http:type "application/xml";
	http:transform <#template.xsl>;
	obj:xslt <user-search.xsl>.

purl:user-search rdfs:subClassOf purl:search;
	http:operation "user";
	http:type "application/sparql-results+xml";
	http:cache-control "must-reevaluate";
	http:transform <#user-search.xsl>;
	obj:sparql """
		SELECT DISTINCT ?uri ?label
		WHERE {
			?uri a purl:User
			OPTIONAL { ?uri rdfs:label ?label }
			{ ?uri calli:name $q }
			UNION { ?uri rdfs:label $q }
			UNION { ?uri purl:affiliation $q }
			UNION { ?uri purl:email $q }
		}
		ORDER BY ?label ?uri
	""".

<#group-search.xsl> rdfs:subClassOf <#search.xsl>;
	http:type "application/xml";
	http:transform <#template.xsl>;
	obj:xslt <group-search.xsl>.

purl:group-search rdfs:subClassOf purl:search;
	http:operation "group";
	http:type "application/sparql-results+xml";
	http:cache-control "must-reevaluate";
	http:transform <#group-search.xsl>;
	obj:sparql """
		SELECT DISTINCT ?uri ?label
		WHERE {
			?uri a purl:Group
			OPTIONAL { ?uri rdfs:label ?label }
			{ ?uri rdfs:label $q }
			UNION { ?uri purl:member [calli:name $q] }
			UNION { ?uri calli:maintainer [calli:name $q] }
			UNION { ?uri calli:maintainer [calli:member [calli:name $q]] }
		}
		ORDER BY ?label ?uri
	""".

<#domain-search.xsl> rdfs:subClassOf <#search.xsl>;
	http:type "application/xml";
	http:transform <#template.xsl>;
	obj:xslt <domain-search.xsl>.

purl:domain-search rdfs:subClassOf purl:search;
	http:operation "domain";
	http:type "application/sparql-results+xml";
	http:cache-control "must-reevaluate";
	http:transform <#domain-search.xsl>;
	obj:sparql """
		SELECT DISTINCT ?uri ?label
		WHERE {
			?uri a purl:Domain
			OPTIONAL { ?uri rdfs:label ?label }
			{ ?uri rdfs:label $q }
			UNION { ?uri calli:maintainer [calli:name $q] }
			UNION { ?uri calli:maintainer [calli:member [calli:name $q]] }
			UNION { ?uri calli:curator [calli:name $q] }
			UNION { ?uri calli:curator [calli:member [calli:name $q]] }
		}
		ORDER BY ?label ?uri
	""".

<#purl-search.xsl> rdfs:subClassOf <#search.xsl>;
	http:type "application/xml";
	http:transform <#template.xsl>;
	obj:xslt <purl-search.xsl>.

purl:purl-search rdfs:subClassOf purl:search;
	http:operation "purl";
	http:type "application/sparql-results+xml";
	http:cache-control "must-reevaluate";
	http:transform <#purl-search.xsl>;
	obj:sparql """
		SELECT DISTINCT ?uri ?label
		WHERE {
			{ ?uri a purl:PURL }
			UNION { ?uri a purl:PartialPURL }
			UNION { ?uri a purl:ZonedPURL }
			UNION { ?uri a purl:DisabledPURL }
			UNION { ?uri a purl:TombstonedPURL }
			OPTIONAL { ?uri rdfs:label ?label }
			{ ?uri calli:maintainer [calli:name $q] }
			UNION { ?uri calli:maintainer [calli:member [calli:name $q]] }
		}
		ORDER BY ?uri
	""".

<#target-search.xsl> rdfs:subClassOf <#search.xsl>;
	http:type "application/xml";
	http:transform <#template.xsl>;
	obj:xslt <target-search.xsl>.

purl:target-search rdfs:subClassOf obj:Message;
	rdfs:subClassOf [owl:onProperty obj:target;
		owl:allValuesFrom purl:Server];
	rdfs:subClassOf [owl:onProperty obj:functionalObjectResponse;
		owl:allValuesFrom obj:TupleResult];
	http:operation "target";
	http:type "application/sparql-results+xml";
	http:cache-control "must-reevaluate";
	http:transform <#target-search.xsl>;
	obj:sparql """
		SELECT DISTINCT ?uri ?label
		WHERE {
			?uri ?rel $q
			{ ?uri a purl:PURL }
			UNION { ?uri a purl:PartialPURL }
			UNION { ?uri a purl:ZonedPURL }
			UNION { ?uri a purl:DisabledPURL }
			UNION { ?uri a purl:TombstonedPURL }
			OPTIONAL { ?uri rdfs:label ?label }
		}
		ORDER BY ?uri
	""".

purl:target-search-arg a owl:ObjectProperty, owl:FunctionalProperty;
	rdfs:domain purl:target-search;
	rdfs:range rdfs:Resource;
	http:type "text/uri-list";
	http:parameter "q";
	obj:name "q".
