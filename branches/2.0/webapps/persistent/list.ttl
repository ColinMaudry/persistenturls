@prefix xsd:<http://www.w3.org/2001/XMLSchema#>.
@prefix rdf:<http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs:<http://www.w3.org/2000/01/rdf-schema#>.
@prefix owl:<http://www.w3.org/2002/07/owl#>.
@prefix obj:<http://www.openrdf.org/rdf/2009/object#>.
@prefix http:<http://www.openrdf.org/rdf/2009/httpobject#>.
@prefix calli:<http://callimachusproject.org/rdf/2009/framework#>.
@prefix purl:<http://persistent.name/rdf/2010/purl#>.

purl:unresolvable-purls rdfs:subClassOf obj:Message;
	rdfs:subClassOf [owl:onProperty obj:target;
		owl:allValuesFrom purl:Origin];
	rdfs:subClassOf [owl:onProperty obj:functionalObjectResponse;
		owl:allValuesFrom obj:TupleResult];
	http:operation "unresolvable";
	http:realm <authority>;
	http:type "application/sparql-results+xml";
	http:cache-control "must-reevaluate";
	http:transform <purl-search-xsl>;
	obj:sparql """
		SELECT DISTINCT ?uri ?label
		WHERE {
			$this purl:part ?domain .
			?uri purl:partOf ?domain; ?pred [a purl:Unresolvable] .
			?pred purl:rel ?rel .
			OPTIONAL { ?uri rdfs:label ?label }
			OPTIONAL {
				?uri a ?disabled
				FILTER (?disabled = purl:DisabledPURL || ?disabled = purl:TombstonedPURL)
			}
			FILTER (!bound(?disabled))
		}
		ORDER BY ?uri
	""".

purl:list-mirrors rdfs:subClassOf obj:Message;
	rdfs:subClassOf [owl:onProperty obj:target;
		owl:allValuesFrom purl:Origin];
	rdfs:subClassOf [owl:onProperty obj:functionalObjectResponse;
		owl:allValuesFrom obj:TupleResult];
	http:operation "mirrors";
	http:realm <authority>;
	http:type "application/sparql-results+xml";
	http:cache-control "must-reevaluate";
	http:transform <search-xsl>;
	obj:sparql """
		SELECT DISTINCT ?uri ?label ?type
		WHERE {
			?uri a purl:RemoteGraph; purl:allowedOrigin $this .
			?label purl:mirroredBy ?uri .
			GRAPH ?uri {
				{ ?label a ?type FILTER (?type = purl:Origin) }
				UNION {
					?label a ?type
					OPTIONAL { ?label ?origin purl:Origin }
					FILTER (!bound(?origin) && ?type = purl:Domain )
				}
			}
		}
		ORDER BY ?label desc(?type) ?uri
	""".

purl:list-purls-for-user rdfs:subClassOf obj:Message;
	rdfs:subClassOf [owl:onProperty obj:target;
		owl:allValuesFrom purl:User];
	rdfs:subClassOf [owl:onProperty obj:functionalObjectResponse;
		owl:allValuesFrom obj:TupleResult];
	http:operation "purls";
	http:realm <authority>;
	http:type "application/sparql-results+xml";
	http:cache-control "must-reevaluate";
	http:transform <purl-search-xsl>;
	obj:sparql """
		SELECT DISTINCT ?uri ?label ?unresolvable
		WHERE {
			{ ?uri a purl:PURL }
			UNION { ?uri a purl:PartialPURL }
			UNION { ?uri a purl:ZonedPURL }
			UNION { ?uri a purl:DisabledPURL }
			UNION { ?uri a purl:TombstonedPURL }
			OPTIONAL { ?uri ?unresolvable [a purl:Unresolvable] }
			OPTIONAL { ?uri rdfs:label ?label }
			{ ?uri calli:maintainer $this }
			UNION { ?uri calli:maintainer [calli:member $this] }
		}
		ORDER BY ?label ?uri
	""".

purl:list-purls-for-group rdfs:subClassOf obj:Message;
	rdfs:subClassOf [owl:onProperty obj:target;
		owl:allValuesFrom calli:Group];
	rdfs:subClassOf [owl:onProperty obj:functionalObjectResponse;
		owl:allValuesFrom obj:TupleResult];
	http:operation "purls";
	http:realm <authority>;
	http:type "application/sparql-results+xml";
	http:cache-control "must-reevaluate";
	http:transform <purl-search-xsl>;
	obj:sparql """
		SELECT DISTINCT ?uri ?label ?unresolvable
		WHERE {
			{ ?uri a purl:PURL }
			UNION { ?uri a purl:PartialPURL }
			UNION { ?uri a purl:ZonedPURL }
			UNION { ?uri a purl:DisabledPURL }
			UNION { ?uri a purl:TombstonedPURL }
			OPTIONAL { ?uri ?unresolvable [a purl:Unresolvable] }
			OPTIONAL { ?uri rdfs:label ?label }
			?uri calli:maintainer $this
		}
		ORDER BY ?label ?uri
	""".

purl:list-domains-for-user rdfs:subClassOf obj:Message;
	rdfs:subClassOf [owl:onProperty obj:target;
		owl:allValuesFrom purl:User];
	rdfs:subClassOf [owl:onProperty obj:functionalObjectResponse;
		owl:allValuesFrom obj:TupleResult];
	http:operation "domains";
	http:realm <authority>;
	http:type "application/sparql-results+xml";
	http:cache-control "must-reevaluate";
	http:transform <domain-search-xsl>;
	obj:sparql """
		SELECT DISTINCT ?uri ?label
		WHERE {
			?origin purl:part ?uri
			OPTIONAL { ?uri rdfs:label ?label }
			{ ?uri calli:maintainer $this }
			UNION { ?uri calli:maintainer [calli:member $this] }
			UNION { ?uri calli:curator $this }
			UNION { ?uri calli:curator [calli:member $this] }
			UNION { ?uri calli:scribe $this }
			UNION { ?uri calli:scribe [calli:member $this] }
		}
		ORDER BY ?label ?uri
	""".

purl:list-domains-for-group rdfs:subClassOf obj:Message;
	rdfs:subClassOf [owl:onProperty obj:target;
		owl:allValuesFrom calli:Group];
	rdfs:subClassOf [owl:onProperty obj:functionalObjectResponse;
		owl:allValuesFrom obj:TupleResult];
	http:operation "domains";
	http:realm <authority>;
	http:type "application/sparql-results+xml";
	http:cache-control "must-reevaluate";
	http:transform <domain-search-xsl>;
	obj:sparql """
		SELECT DISTINCT ?uri ?label
		WHERE {
			?origin purl:part ?uri
			OPTIONAL { ?uri rdfs:label ?label }
			{ ?uri calli:maintainer $this }
			UNION { ?uri calli:curator $this }
			UNION { ?uri calli:scribe $this }
		}
		ORDER BY ?label ?uri
	""".

